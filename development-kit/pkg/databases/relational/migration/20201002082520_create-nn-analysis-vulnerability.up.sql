ALTER TABLE vulnerabilities DROP CONSTRAINT vulnerabilities_analysis_id_fkey;

ALTER TABLE vulnerabilities DROP COLUMN analysis_id;

ALTER TABLE vulnerabilities ADD COLUMN "type" varchar(255) NOT NULL;

ALTER TABLE vulnerabilities ALTER COLUMN vuln_hash TYPE varchar(255) USING vuln_hash::varchar;

CREATE TABLE analysis_vulnerabilities (
     vulnerability_id uuid NOT NULL,
     analysis_id uuid NOT NULL,
     created_at DATE NOT NULL,
     FOREIGN KEY (vulnerability_id) REFERENCES vulnerabilities (vulnerability_id) ON DELETE CASCADE,
     FOREIGN KEY (analysis_id) REFERENCES analysis (analysis_id) ON DELETE CASCADE,
     PRIMARY KEY (analysis_id, vulnerability_id)
);
